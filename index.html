<html>
<head>
    <title>Apache Permissions Fixer</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
</head>
<body>

<div class="container-fluid">
    
    <div class="row">
        <div class="col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" class="form-control" id="username" aria-describedby="usernameHelp">
                <small id="usernameHelp" class="form-text text-muted">Optional. If specified, will add specified user to www-data group</small>
            </div>
            <div class="form-group">
                <label for="folder">Root Folder Path</label>
                <input type="text" class="form-control" id="rootfolder" name="rootfolder" aria-describedby="rootFolderHelp" value="/var/www/">
                <small id="rootFolderHelp" class="form-text text-muted">If empty, </small>
            </div>
            <div class="form-group">
                <label for="folder">Folder Path</label>
                <input type="text" class="form-control" id="folder" name="folder" aria-describedby="folderHelp" value="" required>
                <small id="folderHelp" class="form-text text-muted">If empty, </small>
            </div>
            <button type="button" onclick="generateScript()" class="btn btn-primary">Generate</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content">
            <div class="form-group">
                <label for="output">Example textarea</label>
                <textarea class="form-control" id="output" rows="10"></textarea>
            </div>
        </div>
    </div>
</div>
</div>


<script type="text/javascript">

    function generateScript() {
        let elUsername = document.getElementById('username').value;
        let elRootFolder = document.getElementById('rootfolder').value;
        let elFolder = document.getElementById('folder').value;
        let elOutput = document.getElementById('output');

        let userscript =  elUsername ? "sudo usermod -a -G www-data " + elUsername  + "\n": '';

        let script = "Folder cannot be blank";

        if(elFolder)
        {

            script = elUsername + "cd " + elRootFolder + "\n" +
                "sudo chmod 775 " + elFolder + "\n" +
                "sudo chgrp www-data " + elFolder + "\n" +
                "sudo chmod g+s " + elFolder + "\n" +
                "sudo chgrp -R www-data " + elFolder + "\n" +
                + "cd " + elRootFolder + "\\" + elFolder + "\n" +
                "sudo find . -type f -exec chmod 664 {} \\;\n" +
                "sudo find . -type d -exec chmod 775 {} \\;"
        }


        elOutput.value = script;
    }


</script>
</body>
</html>